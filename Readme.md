# 🎵 音乐库智能分析工具

智能化的音乐库清理和升级工具，支持识别重复歌曲、多版本歌曲、低质量MP3文件，并生成优化建议。

## ✨ 核心功能

### 1. **歌曲分析** 📊
- 🔍 递归扫描整个音乐库
- 📋 提取音乐元数据（标题、艺术家、格式、比特率等）
- 🎯 智能识别问题：
  - **重复歌曲** 🔁 - 完全相同的歌曲，同一首歌的不同格式版本
  - **低质MP3** 🎧 - 仅有MP3格式的歌曲（建议升级）

### 2. **智能清理** 🗑️
- 优先保留高质量格式（FLAC > WAV > ALAC > AAC > MP3）
- 自动标记低优先级文件供删除
- 支持批量删除操作
- 安全确认机制

### 3. **升级工作流** 🚀
- 📝 **生成下载清单** - 自动列出需要升级的歌曲
- 🎵 **多格式导出** - CSV、TXT、JSON 格式
- 📲 **便于操作** - 轻松复制到酷我音乐搜索下载
- ✅ **验证升级** - 再次扫描确认改进

---

## 📦 项目结构

```
MusicAnalyzer/
├── app.py                      # 主 Streamlit Web 应用
├── scanner.py                  # 音乐库扫描模块
├── analyzer.py                 # 分析和清理逻辑
├── export_download_list.py     # 下载清单生成工具
│
├── Readme.md                   # 项目文档（本文件）
├── DOWNLOAD_GUIDE.md           # 详细的下载升级指南
├── run.bat                     # 快速启动脚本（Windows）
│
└── exports/                    # 导出文件目录
    ├── 仅MP3歌曲_*.csv         # 需要升级歌曲列表
    └── download_list_*.txt     # 易读的下载清单
```

---

## 🚀 快速开始

### 方式一：快速启动脚本（推荐）

```bash
# Windows
run.bat
```

然后选择：
- `1` - 启动 Web 应用（Streamlit）
- `2` - 生成下载清单
- `3` - 打开导出文件夹
- `4` - 查看下载指南

### 方式二：直接命令

#### 启动 Web 应用
```bash
streamlit run app.py
```
访问 http://localhost:8501

#### 生成下载清单
```bash
python export_download_list.py
```

---

## 📖 使用流程

### 第1步：扫描音乐库
```
1. 启动应用：streamlit run app.py
2. 在左侧侧栏输入音乐文件夹路径
3. 点击 "🔍 开始扫描" 按钮
4. 等待扫描完成（首次可能需要1-5分钟）
```

### 第2步：查看分析结果
```
- 📦 文件总数：你的音乐库中所有文件
- 🎵 唯一歌曲：去重后的歌曲数
- 🎚️ 多版本歌曲：有多个格式版本的歌曲
- 🎧 仅 MP3 歌曲：质量最低，建议升级
```

### 第3步：选择清理方案

#### 方案A：直接清理
1. 点击对应的功能按钮（重复歌曲/多版本/仅MP3）
2. 查看详细列表
3. 点击 "🗑️ 删除" 删除低质量版本

#### 方案B：升级方案（推荐）
1. 点击 "📝 导出清单"
2. 生成 CSV/TXT/JSON 格式的清单
3. 打开 `exports/download_list_*.txt` 查看清单
4. 按照 [下载指南](./DOWNLOAD_GUIDE.md) 操作

### 第4步：验证结果
```
完成升级或清理后，重新运行扫描确认改进
```

---

## 🎯 使用场景

### 场景1：清理重复文件
```
问题：浪费存储空间，歌曲库混乱

✅ 解决方案：
1. 使用应用扫描库
2. 查看 "🔁 重复歌曲" 标签
3. 删除低优先级版本
4. 节省空间并整理库
```

### 场景2：升级音质
```
问题：某些歌曲仅有 MP3 版本（质量低）

✅ 解决方案：
1. 点击 "📝 导出清单"
2. 在酷我音乐中搜索并下载 FLAC 版本
3. 将新文件放回音乐目录
4. 重新扫描验证升级完成
```

### 场景3：统一格式
```
问题：设备兼容性问题，播放体验不一致

✅ 解决方案：
1. 使用应用分析库
2. 根据格式优先级清理
3. 逐步统一为 FLAC 或 MP3
4. 建立规范的库结构
```

---

## 🔧 技术细节

### 核心算法

**歌曲去重识别** (song_key)
```python
song_key = f"{title}|{artist}|{round(duration)}"
```
- 基于歌曲标题、艺术家、时长
- 完全匹配则为同一首歌

**格式优先级**
| 格式 | 优先级 | 质量 | 说明 |
|------|------|------|------|
| FLAC | 5 | 最佳 | 无损，音乐制作首选 |
| WAV | 4 | 最佳 | 无损，体积较大 |
| ALAC | 4 | 最佳 | 无损，Mac 友好 |
| AAC | 2 | 中等 | 有损，体积小 |
| MP3 | 1 | 最低 | 有损，广泛兼容 |

**删除规则**
- 优先保留高优先级格式
- 删除其他低优先级版本
- 最少保留一个版本

### 技术栈
- **前端框架**：Streamlit (Web UI)
- **数据处理**：Pandas (DataFrame 操作)
- **音频元数据**：Mutagen (读取音乐文件信息)
- **语言**：Python 3.10+

---

## 📊 输出示例

### Web 界面展示
- 左侧侧栏：路径导航、功能选择、库统计
- 中央区域：分析结果、分页显示、删除操作
- 响应式设计：适配不同屏幕尺寸

### 数据导出
- **CSV** - 便于在 Excel 中分析
- **TXT** - 便于复制歌曲名称
- **JSON** - 便于程序处理

---

## ⚙️ 配置

### 默认设置
```python
# app.py
DEFAULT_MUSIC_PATH = "G:\\music"  # 默认扫描路径
```

### 自定义配置
修改 `app.py` 中的初始化代码：
```python
if "current_path" not in st.session_state:
    st.session_state.current_path = "你的音乐路径"
```

---

## 🔍 故障排除

### 问题1：扫描很慢
**原因**：首次扫描需要读取所有文件的元数据
**解决**：
- 考虑排除大型子目录
- 检查磁盘速度（网络磁盘会很慢）

### 问题2：找不到某些音乐文件
**原因**：不支持的格式或编码问题
**解决**：
- 检查文件扩展名
- 查看控制台输出的错误信息

### 问题3：删除操作失败
**原因**：文件被占用或权限不足
**解决**：
- 关闭正在播放的应用
- 以管理员身份运行

---

## 📚 进阶使用

### Python 脚本集成
```python
from scanner import scan_music
from analyzer import analyze, find_duplicates

music_list = scan_music("G:\\music")
df = pd.DataFrame(music_list)
df = analyze(df)

dup_df = find_duplicates(df)
dup_df.to_csv("duplicates.csv")
```

---

## 📝 许可证

MIT License

---

## 📖 相关文档

- [快速启动脚本说明](./run.bat)

---

**最后更新**：2026-01-17  
**版本**：2.0（新增导出清单功能）
